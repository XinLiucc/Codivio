# Codivio ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ¯ é¡¹ç›®å®šä½

**Codivio** - ä¸“æ³¨äºå°å›¢é˜Ÿï¼ˆ3-5äººï¼‰çš„åˆ†å¸ƒå¼å®æ—¶ä»£ç åä½œå¹³å°

### æ ¸å¿ƒç‰¹æ€§
- ğŸ”¥ **åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„** - å­¦ä¹ ä¼ä¸šçº§æ¶æ„è®¾è®¡
- âš¡ **å®æ—¶åä½œç¼–è¾‘** - å¤šäººåŒæ­¥ç¼–è¾‘ï¼Œå†²çªè§£å†³
- ğŸ³ **Dockerå®¹å™¨åŒ–** - ä¸€é”®éƒ¨ç½²ï¼Œå¼¹æ€§æ‰©å®¹
- ğŸ—ï¸ **é¡¹ç›®ç®¡ç†** - æ–‡ä»¶æ ‘ï¼Œæƒé™æ§åˆ¶ï¼Œå›¢é˜Ÿåä½œ

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### MVPæ¶æ„å…¨æ™¯å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ç”¨æˆ·ç•Œé¢                              â”‚
â”‚                   Vue 3 + TypeScript                        â”‚
â”‚              Monaco Editor + WebSocket                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nginx è´Ÿè½½å‡è¡¡                          â”‚
â”‚                   SSLç»ˆæ­¢ + é™æ€èµ„æº                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring Gateway ç½‘å…³                       â”‚
â”‚              è·¯ç”±è½¬å‘ + ç»Ÿä¸€è®¤è¯ + é™æµ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç”¨æˆ·æœåŠ¡  â”‚         â”‚ é¡¹ç›®æœåŠ¡  â”‚         â”‚ åä½œæœåŠ¡  â”‚
   â”‚ :8081   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ :8082   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ :8083   â”‚
   â”‚JWTè®¤è¯   â”‚         â”‚æ–‡ä»¶ç®¡ç†  â”‚         â”‚å®æ—¶ç¼–è¾‘  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â”‚                     â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚              â”‚RabbitMQ â”‚
        â”‚                     â”‚              â”‚æ¶ˆæ¯é˜Ÿåˆ—  â”‚
        â”‚                     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ MySQL   â”‚         â”‚ MySQL   â”‚         â”‚ Redis   â”‚
   â”‚ ç”¨æˆ·æ•°æ®  â”‚         â”‚ é¡¹ç›®æ•°æ®  â”‚         â”‚ å®æ—¶çŠ¶æ€  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§© å¾®æœåŠ¡æ‹†åˆ†ç­–ç•¥

### æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†ï¼ˆDDDåŸåˆ™ï¼‰

#### 1. ç”¨æˆ·æœåŠ¡ (User Service) - ç«¯å£ 8081
```yaml
ä¸šåŠ¡èŒè´£:
  - ç”¨æˆ·æ³¨å†Œ/ç™»å½•/ç™»å‡º
  - JWT ä»¤ç‰Œç®¡ç†å’ŒéªŒè¯
  - ç”¨æˆ·ä¿¡æ¯ç®¡ç†
  - æƒé™æ§åˆ¶

æŠ€æœ¯æ ˆ:
  - Spring Boot 3.x + Spring Security
  - JWT + Redis Session
  - MySQL (ç”¨æˆ·æ•°æ®)

Dockeré•œåƒ: codivio/user-service:latest
```

#### 2. é¡¹ç›®æœåŠ¡ (Project Service) - ç«¯å£ 8082  
```yaml
ä¸šåŠ¡èŒè´£:
  - é¡¹ç›® CRUD æ“ä½œ
  - æ–‡ä»¶æ ‘ç®¡ç† (å¢åˆ æ”¹æŸ¥)
  - å›¢é˜Ÿæˆå‘˜ç®¡ç†
  - æƒé™åˆ†é…

æŠ€æœ¯æ ˆ:
  - Spring Boot 3.x + MyBatis Plus
  - MySQL (é¡¹ç›®æ•°æ®)
  - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

Dockeré•œåƒ: codivio/project-service:latest
```

#### 3. åä½œæœåŠ¡ (Collaboration Service) - ç«¯å£ 8083
```yaml
ä¸šåŠ¡èŒè´£:
  - å®æ—¶åä½œç¼–è¾‘
  - WebSocket è¿æ¥ç®¡ç†
  - æ“ä½œè½¬æ¢ç®—æ³• (OT)
  - åœ¨çº¿ç”¨æˆ·ç®¡ç†
  - ç®€å•èŠå¤©åŠŸèƒ½

æŠ€æœ¯æ ˆ:
  - Spring Boot 3.x + WebSocket
  - Redis (å®æ—¶çŠ¶æ€ç¼“å­˜)
  - RabbitMQ (äº‹ä»¶é€šçŸ¥)

Dockeré•œåƒ: codivio/collaboration-service:latest
```

#### 4. ç½‘å…³æœåŠ¡ (Gateway Service) - ç«¯å£ 8080
```yaml
ä¸šåŠ¡èŒè´£:
  - ç»Ÿä¸€å…¥å£è·¯ç”±
  - è´Ÿè½½å‡è¡¡
  - ç»Ÿä¸€è®¤è¯æ‹¦æˆª
  - è¯·æ±‚é™æµ

æŠ€æœ¯æ ˆ:
  - Spring Cloud Gateway
  - Redis (é™æµå­˜å‚¨)

Dockeré•œåƒ: codivio/gateway-service:latest
```

## ğŸ”„ æœåŠ¡é—´é€šä¿¡æ¶æ„

### 1. åŒæ­¥é€šä¿¡ (REST API + OpenFeign)
```java
// ç”¨æˆ·æœåŠ¡è°ƒç”¨é¡¹ç›®æœåŠ¡
@FeignClient(name = "project-service", url = "http://project-service:8082")
public interface ProjectServiceClient {
    
    @GetMapping("/api/projects/user/{userId}")
    List<ProjectDTO> getUserProjects(@PathVariable("userId") Long userId);
    
    @PostMapping("/api/projects/{projectId}/members")
    void addProjectMember(@PathVariable String projectId, 
                         @RequestBody MemberDTO member);
}

// ä½¿ç”¨ç¤ºä¾‹
@RestController
public class UserController {
    
    @Autowired
    private ProjectServiceClient projectServiceClient;
    
    @GetMapping("/api/users/{userId}/projects")
    public ResponseEntity<List<ProjectDTO>> getUserProjects(@PathVariable Long userId) {
        List<ProjectDTO> projects = projectServiceClient.getUserProjects(userId);
        return ResponseEntity.ok(projects);
    }
}
```

### 2. å¼‚æ­¥é€šä¿¡ (RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—)
```java
// äº‹ä»¶å‘å¸ƒè€… - ç”¨æˆ·æœåŠ¡
@Service
public class UserEventPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void publishUserCreatedEvent(User user) {
        UserCreatedEvent event = new UserCreatedEvent(user.getId(), user.getUsername());
        rabbitTemplate.convertAndSend("user.exchange", "user.created", event);
    }
}

// äº‹ä»¶æ¶ˆè´¹è€… - é¡¹ç›®æœåŠ¡
@Component
public class UserEventListener {
    
    @RabbitListener(queues = "project.user.created")
    public void handleUserCreated(UserCreatedEvent event) {
        // ä¸ºæ–°ç”¨æˆ·åˆ›å»ºé»˜è®¤é¡¹ç›®æ–‡ä»¶å¤¹
        projectService.createDefaultWorkspace(event.getUserId());
    }
}
```

### 3. å®æ—¶é€šä¿¡ (WebSocket)
```java
// åä½œæœåŠ¡ä¸­çš„ WebSocket å¤„ç†
@Component
public class CollaborationWebSocketHandler extends TextWebSocketHandler {
    
    private final ConcurrentHashMap<String, Set<WebSocketSession>> documentSessions = new ConcurrentHashMap<>();
    
    @Override
    public void afterConnectionEstablished(WebSocketSession session) {
        String documentId = getDocumentId(session);
        documentSessions.computeIfAbsent(documentId, k -> ConcurrentHashMap.newKeySet())
                        .add(session);
    }
    
    @Override
    protected void handleTextMessage(WebSocketSession session, TextMessage message) {
        // å¤„ç†å®æ—¶ç¼–è¾‘æ“ä½œ
        EditOperation operation = JSON.parseObject(message.getPayload(), EditOperation.class);
        broadcastToOtherUsers(session, operation);
    }
}
```

## ğŸ’¾ æ•°æ®å­˜å‚¨æ¶æ„è®¾è®¡

### æ•°æ®åº“é€‰å‹ç­–ç•¥

#### MySQL - ä¸šåŠ¡æ•°æ®å­˜å‚¨
```sql
-- ==== ç”¨æˆ·æœåŠ¡æ•°æ®åº“ ====
CREATE DATABASE codivio_user;
USE codivio_user;

-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    email VARCHAR(100) UNIQUE NOT NULL COMMENT 'é‚®ç®±',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ',
    nickname VARCHAR(50) COMMENT 'æ˜µç§°',
    avatar_url VARCHAR(255) COMMENT 'å¤´åƒåœ°å€',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€: 1-æ­£å¸¸, 0-ç¦ç”¨',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_email (email)
) COMMENT='ç”¨æˆ·è¡¨';

-- ==== é¡¹ç›®æœåŠ¡æ•°æ®åº“ ====
CREATE DATABASE codivio_project;
USE codivio_project;

-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id VARCHAR(32) PRIMARY KEY COMMENT 'é¡¹ç›®ID(é›ªèŠ±ç®—æ³•)',
    name VARCHAR(100) NOT NULL COMMENT 'é¡¹ç›®åç§°',
    description TEXT COMMENT 'é¡¹ç›®æè¿°',
    owner_id BIGINT NOT NULL COMMENT 'åˆ›å»ºè€…ID',
    language VARCHAR(20) DEFAULT 'javascript' COMMENT 'ä¸»è¦ç¼–ç¨‹è¯­è¨€',
    visibility ENUM('private', 'public') DEFAULT 'private' COMMENT 'å¯è§æ€§',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€: 1-æ­£å¸¸, 0-åˆ é™¤',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_owner (owner_id),
    INDEX idx_status (status)
) COMMENT='é¡¹ç›®è¡¨';

-- é¡¹ç›®æˆå‘˜è¡¨
CREATE TABLE project_members (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id VARCHAR(32) NOT NULL COMMENT 'é¡¹ç›®ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    role ENUM('owner', 'admin', 'editor', 'viewer') DEFAULT 'editor' COMMENT 'è§’è‰²',
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åŠ å…¥æ—¶é—´',
    UNIQUE KEY uk_project_user (project_id, user_id),
    INDEX idx_user (user_id)
) COMMENT='é¡¹ç›®æˆå‘˜è¡¨';

-- æ–‡ä»¶è¡¨
CREATE TABLE project_files (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id VARCHAR(32) NOT NULL COMMENT 'é¡¹ç›®ID',
    file_path VARCHAR(500) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
    file_name VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶å',
    file_type ENUM('file', 'directory') DEFAULT 'file' COMMENT 'ç±»å‹',
    content LONGTEXT COMMENT 'æ–‡ä»¶å†…å®¹',
    size BIGINT DEFAULT 0 COMMENT 'æ–‡ä»¶å¤§å°(å­—èŠ‚)',
    created_by BIGINT NOT NULL COMMENT 'åˆ›å»ºè€…',
    updated_by BIGINT COMMENT 'æœ€åæ›´æ–°è€…',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_project_path (project_id, file_path),
    INDEX idx_project (project_id)
) COMMENT='é¡¹ç›®æ–‡ä»¶è¡¨';
```

#### Redis - å®æ—¶çŠ¶æ€ç®¡ç†
```yaml
# Redis æ•°æ®ç»“æ„è®¾è®¡
æ•°æ®åº“åˆ†é…:
  DB0: # JWT ä¸ç”¨æˆ·ä¼šè¯
    - "jwt:blacklist:{tokenId}"     # JWT é»‘åå•
    - "user:session:{userId}"       # ç”¨æˆ·åœ¨çº¿çŠ¶æ€
    - "user:permissions:{userId}"   # ç”¨æˆ·æƒé™ç¼“å­˜
    
  DB1: # å®æ—¶åä½œçŠ¶æ€
    - "document:content:{fileId}"   # æ–‡æ¡£å½“å‰å†…å®¹
    - "document:version:{fileId}"   # æ–‡æ¡£ç‰ˆæœ¬å·
    - "document:users:{fileId}"     # æ–‡æ¡£åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
    - "operation:queue:{fileId}"    # æ“ä½œæ“ä½œé˜Ÿåˆ—
    - "cursor:position:{fileId}:{userId}" # ç”¨æˆ·å…‰æ ‡ä½ç½®
    
  DB2: # ç³»ç»Ÿç¼“å­˜
    - "project:info:{projectId}"    # é¡¹ç›®ä¿¡æ¯ç¼“å­˜
    - "project:members:{projectId}" # é¡¹ç›®æˆå‘˜ç¼“å­˜
    - "rate:limit:{userId}"         # ç”¨æˆ·é™æµ

# ç¤ºä¾‹æ•°æ®ç»“æ„
Redisé”®å€¼ç¤ºä¾‹:
  # æ–‡æ¡£åœ¨çº¿ç”¨æˆ· (Set)
  "document:users:file_123" : ["user_456", "user_789"]
  
  # ç”¨æˆ·å…‰æ ‡ä½ç½® (Hash)
  "cursor:position:file_123:user_456" : {
    "line": 10,
    "column": 25,
    "timestamp": 1640995200000
  }
  
  # æ“ä½œé˜Ÿåˆ— (List)
  "operation:queue:file_123" : [
    {
      "type": "insert",
      "position": 100,
      "text": "hello",
      "userId": "user_456",
      "timestamp": 1640995200000
    }
  ]
```

#### æ¶ˆæ¯é˜Ÿåˆ— (RabbitMQ) - äº‹ä»¶é©±åŠ¨
```yaml
RabbitMQ äº¤æ¢æœºè®¾è®¡:
  äº¤æ¢æœº:
    - user.events      # ç”¨æˆ·ç›¸å…³äº‹ä»¶
    - project.events   # é¡¹ç›®ç›¸å…³äº‹ä»¶  
    - collaboration.events # åä½œç›¸å…³äº‹ä»¶
    
  é˜Ÿåˆ—è®¾è®¡:
    # ç”¨æˆ·äº‹ä»¶é˜Ÿåˆ—
    - queue: user.created
      binding: user.events -> user.created
      consumer: project-service
      
    - queue: user.updated  
      binding: user.events -> user.updated
      consumer: collaboration-service
      
    # é¡¹ç›®äº‹ä»¶é˜Ÿåˆ—
    - queue: project.member.added
      binding: project.events -> project.member.added
      consumer: user-service, collaboration-service
      
    # åä½œäº‹ä»¶é˜Ÿåˆ—
    - queue: collaboration.operation
      binding: collaboration.events -> collaboration.operation
      consumer: project-service (å®æ—¶ä¿å­˜)
```

## ğŸ”„ å®æ—¶é€šä¿¡æ¶æ„

### WebSocketè¿æ¥ç®¡ç†
```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new CollaborativeEditHandler(), "/ws/editor")
                .setAllowedOrigins("*")
                .withSockJS();
    }
}

// è¿æ¥æ± ç®¡ç†
@Component
public class WebSocketConnectionManager {
    private final Map<String, Set<WebSocketSession>> documentSessions = new ConcurrentHashMap<>();
    private final Map<String, String> sessionToDocument = new ConcurrentHashMap<>();
    
    public void addSession(String documentId, WebSocketSession session) {
        documentSessions.computeIfAbsent(documentId, k -> new ConcurrentHashMap<>())
                        .add(session);
        sessionToDocument.put(session.getId(), documentId);
    }
    
    public void removeSession(WebSocketSession session) {
        String documentId = sessionToDocument.remove(session.getId());
        if (documentId != null) {
            Set<WebSocketSession> sessions = documentSessions.get(documentId);
            if (sessions != null) {
                sessions.remove(session);
            }
        }
    }
}
```

### æ“ä½œè½¬æ¢ç®—æ³•æ ¸å¿ƒ
```java
@Service
public class OperationTransformService {
    
    public Operation transformOperation(Operation op1, Operation op2) {
        // æ’å…¥-æ’å…¥è½¬æ¢
        if (op1.isInsert() && op2.isInsert()) {
            if (op1.getPosition() <= op2.getPosition()) {
                return op2.withPosition(op2.getPosition() + op1.getLength());
            }
            return op2;
        }
        
        // åˆ é™¤-åˆ é™¤è½¬æ¢
        if (op1.isDelete() && op2.isDelete()) {
            if (op1.getPosition() + op1.getLength() <= op2.getPosition()) {
                return op2.withPosition(op2.getPosition() - op1.getLength());
            }
            if (op1.getPosition() >= op2.getPosition() + op2.getLength()) {
                return op2;
            }
            // é‡å åˆ é™¤å¤„ç†
            return handleOverlappingDelete(op1, op2);
        }
        
        // æ’å…¥-åˆ é™¤è½¬æ¢
        if (op1.isInsert() && op2.isDelete()) {
            if (op1.getPosition() <= op2.getPosition()) {
                return op2.withPosition(op2.getPosition() + op1.getLength());
            }
            if (op1.getPosition() < op2.getPosition() + op2.getLength()) {
                return op2.withLength(op2.getLength() + op1.getLength());
            }
            return op2;
        }
        
        return op2;
    }
}
```

## ğŸ“‹ åˆ†é˜¶æ®µå®ç°è®¡åˆ’

### ğŸš€ ç¬¬ä¸€é˜¶æ®µ (4-6å‘¨) - MVP æ ¸å¿ƒåŠŸèƒ½

#### Week 1-2: åŸºç¡€æ¶æ„æ­å»º
```yaml
ç›®æ ‡: å®Œæˆå¾®æœåŠ¡åŸºç¡€æ¡†æ¶
ä»»åŠ¡æ¸…å•:
  âœ… Docker ç¯å¢ƒé…ç½®å’Œç»Ÿä¸€åŸºç¡€é•œåƒ
  âœ… MySQL æ•°æ®åº“è®¾è®¡å’Œåˆå§‹åŒ–è„šæœ¬
  âœ… Redis ç¼“å­˜é…ç½®å’Œæ•°æ®ç»“æ„è®¾è®¡
  âœ… RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—æ­å»º
  âœ… ç”¨æˆ·æœåŠ¡å¼€å‘(æ³¨å†Œ/ç™»å½•/JWT)
  âœ… Spring Gateway ç½‘å…³æœåŠ¡æ­å»º
  âœ… docker-compose.yml ç»Ÿä¸€ç¼–æ’é…ç½®

éªŒæ”¶æ ‡å‡†:
  - å¯ä»¥ä¸€é”®å¯åŠ¨æ‰€æœ‰åŸºç¡€æœåŠ¡
  - ç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•å¹¶è·å– JWT ä»¤ç‰Œ
  - ç½‘å…³æ­£å¸¸è·¯ç”±è¯·æ±‚åˆ°ç”¨æˆ·æœåŠ¡
```

#### Week 3-4: é¡¹ç›®ç®¡ç†æ¨¡å—
```yaml
ç›®æ ‡: å®Œæˆé¡¹ç›®å’Œæ–‡ä»¶ç®¡ç†åŠŸèƒ½
ä»»åŠ¡æ¸…å•:
  âœ… é¡¹ç›®æœåŠ¡å¼€å‘(é¡¹ç›® CRUD)
  âœ… æ–‡ä»¶æ ‘ç®¡ç†(åˆ›å»º/åˆ é™¤/é‡å‘½å/ç§»åŠ¨)
  âœ… é¡¹ç›®æˆå‘˜ç®¡ç†(é‚€è¯·/ç§»é™¤/æƒé™æ§åˆ¶)
  âœ… æ–‡ä»¶å†…å®¹å­˜å‚¨å’Œè¯»å–
  âœ… æœåŠ¡é—´é€šä¿¡(OpenFeign + æ¶ˆæ¯é˜Ÿåˆ—)
  âœ… å‰ç«¯ Vue3 é¡¹ç›®åˆå§‹åŒ–

éªŒæ”¶æ ‡å‡†:
  - ç”¨æˆ·å¯ä»¥åˆ›å»ºé¡¹ç›®å’Œæ–‡ä»¶å¤¹
  - å¯ä»¥é‚€è¯·æˆå‘˜åŠ å…¥é¡¹ç›®
  - æ”¯æŒæ–‡ä»¶çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
  - å‰ç«¯ç•Œé¢å¯ä»¥æ˜¾ç¤ºé¡¹ç›®åˆ—è¡¨å’Œæ–‡ä»¶æ ‘
```

#### Week 5-6: å®æ—¶åä½œç¼–è¾‘
```yaml
ç›®æ ‡: å®ŒæˆåŸºç¡€çš„å®æ—¶åä½œç¼–è¾‘åŠŸèƒ½
ä»»åŠ¡æ¸…å•:
  âœ… åä½œæœåŠ¡ WebSocket æœåŠ¡å™¨æ­å»º
  âœ… åœ¨çº¿ç”¨æˆ·ç®¡ç†å’ŒçŠ¶æ€åŒæ­¥
  âœ… åŸºç¡€çš„å®æ—¶æ–‡å­—åŒæ­¥åŠŸèƒ½
  âœ… ç®€å•çš„å†²çªå¤„ç†æœºåˆ¶
  âœ… ç”¨æˆ·å…‰æ ‡ä½ç½®åŒæ­¥
  âœ… å‰ç«¯ Monaco Editor é›†æˆ
  âœ… å®æ—¶åä½œç•Œé¢å¼€å‘

éªŒæ”¶æ ‡å‡†:
  - å¤šä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶ç¼–è¾‘åŒä¸€æ–‡ä»¶
  - å®æ—¶çœ‹åˆ°å…¶ä»–ç”¨æˆ·çš„å…‰æ ‡ä½ç½®
  - æ–‡å­—å˜æ›´å¯ä»¥å®æ—¶åŒæ­¥
  - åŸºæœ¬å†²çªå¯ä»¥æ­£ç¡®è§£å†³
```

### ğŸ”§ ç¬¬äºŒé˜¶æ®µ (3-4å‘¨) - åŠŸèƒ½å®Œå–„
```yaml
ç›®æ ‡: æå‡ç³»ç»Ÿç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ
ä»»åŠ¡æ¸…å•:
  âœ… æ“ä½œè½¬æ¢ç®—æ³•(OT)ä¼˜åŒ–
  âœ… åœ¨çº¿ç”¨æˆ·åˆ—è¡¨å’ŒçŠ¶æ€æ˜¾ç¤º
  âœ… ç®€å•çš„å®æ—¶èŠå¤©åŠŸèƒ½
  âœ… æ–‡ä»¶å†å²ç‰ˆæœ¬ç®¡ç†
  âœ… ç³»ç»Ÿç›‘æ§å’Œæ—¥å¿—é›†æˆ
  âœ… å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ¢å¤
  âœ… æ€§èƒ½ä¼˜åŒ–å’Œå‹åŠ›æµ‹è¯•

éªŒæ”¶æ ‡å‡†:
  - å¤æ‚ç¼–è¾‘åœºæ™¯ä¸‹å†²çªè§£å†³æ­£ç¡®
  - æ”¯æŒ 5 ä¸ªç”¨æˆ·åŒæ—¶åœ¨çº¿ç¼–è¾‘
  - å…·å¤‡åŸºç¡€çš„ç›‘æ§å’Œå‘Šè­¦èƒ½åŠ›
```

### ğŸš€ ç¬¬ä¸‰é˜¶æ®µ (å¯é€‰æ‰©å±•) - é«˜çº§ç‰¹æ€§
```yaml
ç›®æ ‡: å¢åŠ é«˜çº§åä½œåŠŸèƒ½
ä»»åŠ¡æ¸…å•:
  âœ… Git ç‰ˆæœ¬æ§åˆ¶é›†æˆ
  âœ… ä»£ç æ‰§è¡Œç¯å¢ƒ(ç®€å•ç‰ˆ)
  âœ… ä»£ç  Review åŠŸèƒ½
  âœ… æ™ºèƒ½ä»£ç æç¤º(LSP é›†æˆ)
  âœ… ç§»åŠ¨ç«¯é€‚é…
```

## ğŸ” æŠ€æœ¯é€‰å‹å†³ç­–è®°å½•

### æ ¸å¿ƒæŠ€æœ¯å†³ç­–

#### 1. å¾®æœåŠ¡æ‹†åˆ†ç­–ç•¥
```yaml
å†³ç­–: æŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ†(DDD) + å•ä¸€èŒè´£åŸåˆ™

ç†ç”±:
  âœ… æ¯ä¸ªæœåŠ¡èŒè´£æ˜ç¡®ï¼Œè¾¹ç•Œæ¸…æ™°
  âœ… ä¾¿äºå­¦ä¹ å¾®æœåŠ¡æ¶æ„è®¾è®¡
  âœ… æ”¯æŒç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
  âœ… é™ä½ç³»ç»Ÿè€¦åˆåº¦

æ›¿ä»£æ–¹æ¡ˆ:
  âŒ å•ä½“åº”ç”¨ - ä¸èƒ½ä½“ç°åˆ†å¸ƒå¼ç‰¹æ€§
  âŒ è¿‡ç»†ç²’åº¦æ‹†åˆ† - å¢åŠ å¤æ‚åº¦ï¼Œä¸é€‚åˆå­¦ä¹ 
```

#### 2. æ•°æ®å­˜å‚¨é€‰å‹
```yaml
å†³ç­–: MySQL + Redis + RabbitMQ

ç†ç”±:
  MySQL:
    âœ… å…³ç³»å‹æ•°æ®é€‚åˆç”¨æˆ·ã€é¡¹ç›®ç®¡ç†
    âœ… ACID ç‰¹æ€§ä¿è¯æ•°æ®ä¸€è‡´æ€§
    âœ… æˆç†Ÿç¨³å®šï¼Œå­¦ä¹ æˆæœ¬ä½
    âœ… äº‘å‚å•†æ”¯æŒå¥½
  
  Redis:
    âœ… é«˜æ€§èƒ½ç¼“å­˜ï¼Œé€‚åˆå®æ—¶æ•°æ®
    âœ… æ”¯æŒå¤šç§æ•°æ®ç»“æ„
    âœ… æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å¼
  
  RabbitMQ:
    âœ… æ¶ˆæ¯å¯é æ€§é«˜ï¼Œæ”¯æŒäº‹åŠ¡
    âœ… ç®¡ç†ç•Œé¢å‹å¥½ï¼Œä¾¿äºè°ƒè¯•
    âœ… æ”¯æŒå¤šç§æ¶ˆæ¯æ¨¡å¼

æ›¿ä»£æ–¹æ¡ˆ:
  âŒ PostgreSQL - è¿‡åº¦å·¥ç¨‹åŒ–ï¼Œå­¦ä¹ æˆæœ¬é«˜
  âŒ MongoDB - ä¸é€‚åˆå…³ç³»å‹ä¸šåŠ¡æ•°æ®
  âŒ Kafka - å¯¹äºå°é¡¹ç›®è¿‡äºå¤æ‚
```

#### 3. å®¹å™¨åŒ–æ–¹æ¡ˆ
```yaml
å†³ç­–: Docker + Docker Compose

ç†ç”±:
  âœ… ç¯å¢ƒä¸€è‡´æ€§ï¼Œé¿å…"åœ¨æˆ‘æœºå™¨ä¸Šå¯ä»¥è¿è¡Œ"é—®é¢˜
  âœ… ä¸€é”®éƒ¨ç½²ï¼Œé™ä½å¼€å‘å’Œéƒ¨ç½²é—¨æ§›
  âœ… èµ„æºéš”ç¦»ï¼Œæ”¯æŒå¼¹æ€§æ‰©å®¹
  âœ… ä¾¿äºå­¦ä¹ å®¹å™¨æŠ€æœ¯

æ›¿ä»£æ–¹æ¡ˆ:
  âŒ ç›´æ¥éƒ¨ç½² - ç¯å¢ƒä¾èµ–å¤æ‚ï¼Œéš¾ä»¥ç®¡ç†
  âŒ Kubernetes - å¯¹äºå­¦ä¹ é¡¹ç›®è¿‡äºå¤æ‚
```

## ğŸ” å®‰å…¨æ¶æ„è®¾è®¡

### å®‰å…¨åˆ†å±‚é˜²æŠ¤
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           ç½‘ç»œå®‰å…¨å±‚                 â•‘
â•‘  - HTTPS/WSS åŠ å¯†ä¼ è¾“              â•‘
â•‘  - Nginx é™æµå’Œé˜²æŠ¤                 â•‘
â•‘  - CORS è·¨åŸŸè®¿é—®æ§åˆ¶               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           è®¤è¯æˆæƒå±‚                 â•‘
â•‘  - JWT ä»¤ç‰Œè®¤è¯                     â•‘
â•‘  - RBAC è§’è‰²æƒé™æ§åˆ¶               â•‘
â•‘  - ç»Ÿä¸€ç½‘å…³è®¤è¯                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           åº”ç”¨å®‰å…¨å±‚                 â•‘
â•‘  - è¾“å…¥éªŒè¯å’Œå‚æ•°è¿‡æ»¤             â•‘
â•‘  - SQL æ³¨å…¥é˜²æŠ¤                    â•‘
â•‘  - XSS æ”»å‡»é˜²æŠ¤                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                   â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           æ•°æ®å®‰å…¨å±‚                 â•‘
â•‘  - æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨               â•‘
â•‘  - æ•°æ®åº“è®¿é—®æ§åˆ¶                  â•‘
â•‘  - å®šæœŸæ•°æ®å¤‡ä»½                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### JWT è®¤è¯æœºåˆ¶
```java
// JWT é…ç½®
@Configuration
public class JwtConfig {
    
    @Value("${jwt.secret}")
    private String jwtSecret;
    
    @Value("${jwt.expiration:86400}") // 24å°æ—¶
    private int jwtExpiration;
    
    public String generateToken(User user) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", user.getId());
        claims.put("username", user.getUsername());
        claims.put("roles", user.getRoles());
        
        return Jwts.builder()
                .setClaims(claims)
                .setSubject(user.getUsername())
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + jwtExpiration * 1000))
                .signWith(SignatureAlgorithm.HS256, jwtSecret)
                .compact();
    }
    
    public boolean validateToken(String token) {
        try {
            // æ£€æŸ¥æ˜¯å¦åœ¨é»‘åå•ä¸­
            if (isTokenBlacklisted(token)) {
                return false;
            }
            
            Jwts.parser().setSigningKey(jwtSecret).parseClaimsJws(token);
            return true;
        } catch (JwtException | IllegalArgumentException e) {
            return false;
        }
    }
}

// ç½‘å…³è®¤è¯è¿‡æ»¤å™¨
@Component
public class JwtAuthenticationFilter implements GlobalFilter {
    
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String path = exchange.getRequest().getPath().value();
        
        // ç™½åå•è·¯å¾„ï¼ˆç™»å½•ã€æ³¨å†Œç­‰ï¼‰
        if (isWhiteListPath(path)) {
            return chain.filter(exchange);
        }
        
        String token = extractToken(exchange.getRequest());
        if (token == null || !jwtConfig.validateToken(token)) {
            return unauthorized(exchange.getResponse());
        }
        
        // å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚å¤´
        ServerHttpRequest mutatedRequest = exchange.getRequest().mutate()
                .header("X-User-Id", getUserIdFromToken(token))
                .header("X-Username", getUsernameFromToken(token))
                .build();
                
        return chain.filter(exchange.mutate().request(mutatedRequest).build());
    }
}
```

### RBAC æƒé™æ§åˆ¶
```java
// æƒé™æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequirePermission {
    String value();  // æ‰€éœ€æƒé™
    String resource() default ""; // èµ„æºç±»å‹
}

// æƒé™æ‹¦æˆªå™¨
@Aspect
@Component
public class PermissionAspect {
    
    @Around("@annotation(requirePermission)")
    public Object checkPermission(ProceedingJoinPoint point, RequirePermission requirePermission) throws Throwable {
        
        // è·å–å½“å‰ç”¨æˆ·
        Long userId = getCurrentUserId();
        String permission = requirePermission.value();
        String resource = requirePermission.resource();
        
        // æ£€æŸ¥æƒé™
        if (!permissionService.hasPermission(userId, permission, resource)) {
            throw new AccessDeniedException("æ²¡æœ‰æƒé™è®¿é—®: " + permission);
        }
        
        return point.proceed();
    }
}

// ä½¿ç”¨ç¤ºä¾‹
@RestController
public class ProjectController {
    
    @PostMapping("/projects")
    @RequirePermission("project:create")
    public ResponseEntity<Project> createProject(@RequestBody ProjectRequest request) {
        // åˆ›å»ºé¡¹ç›®é€»è¾‘
        return ResponseEntity.ok(projectService.createProject(request));
    }
    
    @PutMapping("/projects/{projectId}")
    @RequirePermission(value = "project:edit", resource = "project")
    public ResponseEntity<Project> updateProject(@PathVariable String projectId, 
                                                @RequestBody ProjectRequest request) {
        // æ›´æ–°é¡¹ç›®é€»è¾‘
        return ResponseEntity.ok(projectService.updateProject(projectId, request));
    }
}
```

## ğŸ“Š ç›‘æ§å’Œè§‚æµ‹æ€§

### Actuator å¥åº·æ£€æŸ¥
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# å¥åº·æ£€æŸ¥é…ç½®
spring:
  datasource:
    hikari:
      connection-test-query: SELECT 1
  redis:
    timeout: 2000ms
```

### æ—¥å¿—é›†ä¸­åŒ–
```yaml
# logback-spring.xml
<configuration>
    <springProfile name="docker">
        <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
            <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
                <providers>
                    <timestamp/>
                    <logLevel/>
                    <loggerName/>
                    <message/>
                    <mdc/>
                    <pattern>
                        <pattern>{
                            "service": "user-service",
                            "version": "1.0.0",
                            "trace_id": "%X{traceId:-}",
                            "span_id": "%X{spanId:-}"
                        }</pattern>
                    </pattern>
                </providers>
            </encoder>
        </appender>
    </springProfile>
</configuration>

# Docker Compose æ—¥å¿—æ”¶é›†
services:
  filebeat:
    image: elastic/filebeat:8.0.0
    volumes:
      - ./logs:/var/log/codivio
      - ./filebeat.yml:/usr/share/filebeat/filebeat.yml
    depends_on:
      - elasticsearch
```

---

## ğŸ† æ€»ç»“

### æ¶æ„äº®ç‚¹
âœ… **å­¦ä¹ å¯¼å‘**: ä¸“é—¨ä¸ºå­¦ä¹ åˆ†å¸ƒå¼æ¶æ„è€Œè®¾è®¡
âœ… **æŠ€æœ¯å…ˆè¿›**: é‡‡ç”¨ä¸»æµä¼ä¸šçº§æŠ€æœ¯æ ˆ
âœ… **ä¸€é”®éƒ¨ç½²**: Docker Compose ç»Ÿä¸€ç¼–æ’ï¼Œå¼€ç®±å³ç”¨
âœ… **å¯è§‚æµ‹æ€§**: å®Œå–„çš„ç›‘æ§ã€æ—¥å¿—å’Œå¥åº·æ£€æŸ¥
âœ… **å®‰å…¨å¯é **: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼ŒJWT + RBAC æƒé™æ§åˆ¶
âœ… **æ¸è¿›å¼**: åˆ†é˜¶æ®µå®ç°ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®ç›®æ ‡

### é¢è¯•åŠ åˆ†é¡¹
ğŸ’¡ **å¾®æœåŠ¡æ¶æ„è®¾è®¡** - èƒ½æ¸…æ™°è®²è§£æœåŠ¡æ‹†åˆ†é€»è¾‘
ğŸ’¡ **åˆ†å¸ƒå¼ç³»ç»Ÿç»éªŒ** - äº²æ‰‹å¤„ç†æœåŠ¡é—´é€šä¿¡ã€æ•°æ®ä¸€è‡´æ€§
ğŸ’¡ **å®¹å™¨åŒ–éƒ¨ç½²** - å…·å¤‡ Docker å®æˆ˜ç»éªŒ
ğŸ’¡ **å®æ—¶ç³»ç»Ÿè®¾è®¡** - WebSocket + æ“ä½œè½¬æ¢ç®—æ³•
ğŸ’¡ **æ€§èƒ½ä¼˜åŒ–** - ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®åº“ä¼˜åŒ–

### æŠ€æœ¯æˆé•¿è·¯å¾„
ğŸš€ **åˆçº§é˜¶æ®µ**: æŒæ¡å¾®æœåŠ¡åŸºç¡€æ¶æ„
ğŸš€ **ä¸­çº§é˜¶æ®µ**: ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿå¤æ‚æ€§
ğŸš€ **é«˜çº§é˜¶æ®µ**: å…·å¤‡ä¼ä¸šçº§ç³»ç»Ÿè®¾è®¡èƒ½åŠ›
