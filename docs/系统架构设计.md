# ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ¶æ„æ¦‚è§ˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Webæµè§ˆå™¨      â”‚   ç§»åŠ¨ç«¯App      â”‚   VSCodeæ’ä»¶             â”‚
â”‚   Vue 3         â”‚   UniApp        â”‚   TypeScript            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   CDN / Nginx   â”‚
                    â”‚   è´Ÿè½½å‡è¡¡       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  API Gateway    â”‚
                    â”‚ Spring Gateway  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç”¨æˆ·æœåŠ¡  â”‚         â”‚ é¡¹ç›®æœåŠ¡  â”‚         â”‚ ç¼–è¾‘æœåŠ¡  â”‚
   â”‚ User    â”‚         â”‚ Project â”‚         â”‚ Editor  â”‚
   â”‚ Service â”‚         â”‚ Service â”‚         â”‚ Service â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  MySQL  â”‚         â”‚  MySQL  â”‚         â”‚  Redis  â”‚
   â”‚ ç”¨æˆ·æ•°æ®  â”‚         â”‚ é¡¹ç›®æ•°æ®  â”‚         â”‚ å®æ—¶çŠ¶æ€  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ‰§è¡Œç¯å¢ƒæœåŠ¡    â”‚
                    â”‚  Docker Runner  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å¾®æœåŠ¡è®¾è®¡

### æœåŠ¡æ‹†åˆ†ç­–ç•¥

#### 1. ç”¨æˆ·æœåŠ¡ (User Service)
**èŒè´£**: ç”¨æˆ·è®¤è¯ã€æˆæƒã€ä¸ªäººä¿¡æ¯ç®¡ç†
```yaml
ç«¯å£: 8081
æ•°æ®åº“: user_db (MySQL)
æŠ€æœ¯æ ˆ: Spring Boot + Spring Security + JWT
ä¸»è¦åŠŸèƒ½:
  - ç”¨æˆ·æ³¨å†Œ/ç™»å½•
  - JWTä»¤ç‰Œç®¡ç†
  - æƒé™æ§åˆ¶
  - ä¸ªäººèµ„æ–™ç®¡ç†
```

#### 2. é¡¹ç›®æœåŠ¡ (Project Service)
**èŒè´£**: é¡¹ç›®ç®¡ç†ã€æ–‡ä»¶ç®¡ç†ã€å›¢é˜Ÿç®¡ç†
```yaml
ç«¯å£: 8082
æ•°æ®åº“: project_db (MySQL)
æŠ€æœ¯æ ˆ: Spring Boot + MyBatis Plus + JGit
ä¸»è¦åŠŸèƒ½:
  - é¡¹ç›®CRUDæ“ä½œ
  - æ–‡ä»¶ç³»ç»Ÿç®¡ç†
  - Gitç‰ˆæœ¬æ§åˆ¶
  - å›¢é˜Ÿæƒé™ç®¡ç†
```

#### 3. ç¼–è¾‘æœåŠ¡ (Editor Service)
**èŒè´£**: å®æ—¶åä½œç¼–è¾‘ã€æ“ä½œè½¬æ¢ã€çŠ¶æ€åŒæ­¥
```yaml
ç«¯å£: 8083
æ•°æ®åº“: Redis (å®æ—¶çŠ¶æ€) + MongoDB (æ“ä½œå†å²)
æŠ€æœ¯æ ˆ: Spring Boot + WebSocket + Redis
ä¸»è¦åŠŸèƒ½:
  - å®æ—¶åä½œç¼–è¾‘
  - æ“ä½œè½¬æ¢ç®—æ³•
  - å…‰æ ‡ä½ç½®åŒæ­¥
  - åœ¨çº¿ç”¨æˆ·ç®¡ç†
```

#### 4. æ‰§è¡ŒæœåŠ¡ (Execution Service)
**èŒè´£**: ä»£ç æ‰§è¡Œã€ç¯å¢ƒç®¡ç†ã€å®‰å…¨éš”ç¦»
```yaml
ç«¯å£: 8084
æŠ€æœ¯æ ˆ: Spring Boot + Docker API
ä¸»è¦åŠŸèƒ½:
  - å¤šè¯­è¨€ä»£ç æ‰§è¡Œ
  - Dockerå®¹å™¨ç®¡ç†
  - èµ„æºé™åˆ¶å’Œç›‘æ§
  - å®‰å…¨æ²™ç®±
```

### æœåŠ¡é—´é€šä¿¡

#### åŒæ­¥é€šä¿¡ (REST API)
```java
// æœåŠ¡å‘ç°é…ç½®
@EnableEurekaClient
@RestController
public class UserController {
    
    @Autowired
    private ProjectServiceClient projectServiceClient;
    
    @GetMapping("/user/{userId}/projects")
    public List<Project> getUserProjects(@PathVariable String userId) {
        return projectServiceClient.getProjectsByUserId(userId);
    }
}

// Feignå®¢æˆ·ç«¯
@FeignClient("project-service")
public interface ProjectServiceClient {
    @GetMapping("/internal/projects/user/{userId}")
    List<Project> getProjectsByUserId(@PathVariable("userId") String userId);
}
```

#### å¼‚æ­¥é€šä¿¡ (æ¶ˆæ¯é˜Ÿåˆ—)
```yaml
# RabbitMQæ¶ˆæ¯é…ç½®
spring:
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    
# æ¶ˆæ¯ä¸»é¢˜è®¾è®¡
exchanges:
  - user.events      # ç”¨æˆ·äº‹ä»¶
  - project.events   # é¡¹ç›®äº‹ä»¶
  - editor.events    # ç¼–è¾‘äº‹ä»¶
  
queues:
  - user.created     # ç”¨æˆ·åˆ›å»ºäº‹ä»¶
  - project.updated  # é¡¹ç›®æ›´æ–°äº‹ä»¶
  - editor.operation # ç¼–è¾‘æ“ä½œäº‹ä»¶
```

## ğŸ’¾ æ•°æ®å­˜å‚¨è®¾è®¡

### æ•°æ®åº“é€‰å‹å’Œåˆ†å¸ƒ

#### MySQL - å…³ç³»å‹æ•°æ®
```sql
-- ç”¨æˆ·æ•°æ®åº“
CREATE DATABASE user_db;
USE user_db;

-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- é¡¹ç›®æ•°æ®åº“
CREATE DATABASE project_db;
USE project_db;

-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id VARCHAR(32) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    owner_id BIGINT NOT NULL,
    language VARCHAR(20) DEFAULT 'javascript',
    visibility ENUM('private', 'public') DEFAULT 'private',
    git_repository VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- é¡¹ç›®æˆå‘˜è¡¨
CREATE TABLE project_members (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id VARCHAR(32) NOT NULL,
    user_id BIGINT NOT NULL,
    role ENUM('owner', 'admin', 'editor', 'viewer') DEFAULT 'editor',
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY unique_member (project_id, user_id)
);
```

#### Redis - ç¼“å­˜å’Œå®æ—¶çŠ¶æ€
```yaml
# Redisæ•°æ®ç»“æ„è®¾è®¡
databases:
  0: # ä¼šè¯ç¼“å­˜
    - "session:{sessionId}" : "ç”¨æˆ·ä¼šè¯ä¿¡æ¯"
    - "user:{userId}:online" : "ç”¨æˆ·åœ¨çº¿çŠ¶æ€"
    
  1: # ç¼–è¾‘çŠ¶æ€
    - "document:{docId}" : "æ–‡æ¡£å†…å®¹å’Œç‰ˆæœ¬"
    - "room:{docId}:users" : "æˆ¿é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨"
    - "operation:{docId}:queue" : "æ“ä½œé˜Ÿåˆ—"
    
  2: # ç³»ç»Ÿç¼“å­˜  
    - "project:{projectId}" : "é¡¹ç›®ä¿¡æ¯ç¼“å­˜"
    - "user:{userId}:permissions" : "ç”¨æˆ·æƒé™ç¼“å­˜"
```

#### MongoDB - æ“ä½œå†å²å’Œæ—¥å¿—
```javascript
// æ“ä½œå†å²é›†åˆ
db.operation_history.createIndex({ "documentId": 1, "timestamp": 1 })
db.operation_history.insert({
  documentId: "doc_123",
  operation: {
    type: "insert",
    position: 100,
    text: "hello world",
    clientId: "client_456"
  },
  timestamp: new Date(),
  userId: "user_789"
})

// ç³»ç»Ÿæ—¥å¿—é›†åˆ
db.system_logs.createIndex({ "timestamp": 1, "level": 1 })
db.system_logs.insert({
  level: "INFO",
  service: "editor-service",
  message: "User joined document",
  metadata: {
    userId: "user_123",
    documentId: "doc_456"
  },
  timestamp: new Date()
})
```

## ğŸ”„ å®æ—¶é€šä¿¡æ¶æ„

### WebSocketè¿æ¥ç®¡ç†
```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new CollaborativeEditHandler(), "/ws/editor")
                .setAllowedOrigins("*")
                .withSockJS();
    }
}

// è¿æ¥æ± ç®¡ç†
@Component
public class WebSocketConnectionManager {
    private final Map<String, Set<WebSocketSession>> documentSessions = new ConcurrentHashMap<>();
    private final Map<String, String> sessionToDocument = new ConcurrentHashMap<>();
    
    public void addSession(String documentId, WebSocketSession session) {
        documentSessions.computeIfAbsent(documentId, k -> new ConcurrentHashMap<>())
                        .add(session);
        sessionToDocument.put(session.getId(), documentId);
    }
    
    public void removeSession(WebSocketSession session) {
        String documentId = sessionToDocument.remove(session.getId());
        if (documentId != null) {
            Set<WebSocketSession> sessions = documentSessions.get(documentId);
            if (sessions != null) {
                sessions.remove(session);
            }
        }
    }
}
```

### æ“ä½œè½¬æ¢ç®—æ³•æ ¸å¿ƒ
```java
@Service
public class OperationTransformService {
    
    public Operation transformOperation(Operation op1, Operation op2) {
        // æ’å…¥-æ’å…¥è½¬æ¢
        if (op1.isInsert() && op2.isInsert()) {
            if (op1.getPosition() <= op2.getPosition()) {
                return op2.withPosition(op2.getPosition() + op1.getLength());
            }
            return op2;
        }
        
        // åˆ é™¤-åˆ é™¤è½¬æ¢
        if (op1.isDelete() && op2.isDelete()) {
            if (op1.getPosition() + op1.getLength() <= op2.getPosition()) {
                return op2.withPosition(op2.getPosition() - op1.getLength());
            }
            if (op1.getPosition() >= op2.getPosition() + op2.getLength()) {
                return op2;
            }
            // é‡å åˆ é™¤å¤„ç†
            return handleOverlappingDelete(op1, op2);
        }
        
        // æ’å…¥-åˆ é™¤è½¬æ¢
        if (op1.isInsert() && op2.isDelete()) {
            if (op1.getPosition() <= op2.getPosition()) {
                return op2.withPosition(op2.getPosition() + op1.getLength());
            }
            if (op1.getPosition() < op2.getPosition() + op2.getLength()) {
                return op2.withLength(op2.getLength() + op1.getLength());
            }
            return op2;
        }
        
        return op2;
    }
}
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### Kuberneteséƒ¨ç½²
```yaml
# k8s/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: codivio

---
# k8s/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: codivio-config
  namespace: codivio
data:
  mysql.url: "jdbc:mysql://mysql-service:3306/codivio"
  redis.host: "redis-service"
  
---
# k8s/user-service.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
  namespace: codivio
spec:
  replicas: 2
  selector:
    matchLabels:
      app: user-service
  template:
    metadata:
      labels:
        app: user-service
    spec:
      containers:
      - name: user-service
        image: codivio/user-service:latest
        ports:
        - containerPort: 8081
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
        - name: MYSQL_URL
          valueFrom:
            configMapKeyRef:
              name: codivio-config
              key: mysql.url
---
apiVersion: v1
kind: Service
metadata:
  name: user-service
  namespace: codivio
spec:
  selector:
    app: user-service
  ports:
  - port: 8081
    targetPort: 8081
```

### ç›‘æ§å’Œè§‚æµ‹

#### Prometheusç›‘æ§é…ç½®
```yaml
# prometheus/prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'codivio-services'
    static_configs:
      - targets: ['user-service:8081', 'project-service:8082', 'editor-service:8083']
    metrics_path: '/actuator/prometheus'
    
rule_files:
  - "codivio-rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']
```

#### åº”ç”¨æ€§èƒ½ç›‘æ§
```java
// è‡ªå®šä¹‰æŒ‡æ ‡
@RestController
public class MetricsController {
    
    private final MeterRegistry meterRegistry;
    private final Counter collaborationCounter;
    
    public MetricsController(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.collaborationCounter = Counter.builder("codivio.collaboration.operations")
                .description("Number of collaboration operations")
                .tag("service", "editor")
                .register(meterRegistry);
    }
    
    @EventListener
    public void handleCollaborationOperation(CollaborationOperationEvent event) {
        collaborationCounter.increment(
            Tags.of("operation", event.getOperationType(),
                   "document", event.getDocumentId())
        );
    }
}
```

## ğŸ” å®‰å…¨æ¶æ„

### å®‰å…¨å±‚çº§è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç½‘ç»œå®‰å…¨å±‚                 â”‚
â”‚  - HTTPS/WSSåŠ å¯†ä¼ è¾“                â”‚
â”‚  - APIç½‘å…³é™æµå’Œé˜²æŠ¤                â”‚
â”‚  - WAF Webåº”ç”¨é˜²ç«å¢™                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è®¤è¯æˆæƒå±‚                 â”‚
â”‚  - JWTä»¤ç‰Œè®¤è¯                      â”‚
â”‚  - OAuth2.0ç¬¬ä¸‰æ–¹ç™»å½•               â”‚
â”‚  - ç»†ç²’åº¦æƒé™æ§åˆ¶                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å®‰å…¨å±‚                 â”‚
â”‚  - è¾“å…¥éªŒè¯å’Œè¿‡æ»¤                   â”‚
â”‚  - SQLæ³¨å…¥é˜²æŠ¤                      â”‚
â”‚  - XSSæ”»å‡»é˜²æŠ¤                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ•°æ®å®‰å…¨å±‚                 â”‚
â”‚  - æ•°æ®åŠ å¯†å­˜å‚¨                     â”‚
â”‚  - æ•æ„Ÿä¿¡æ¯è„±æ•                     â”‚
â”‚  - å®šæœŸæ•°æ®å¤‡ä»½                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åŸºç¡€è®¾æ–½å®‰å…¨å±‚              â”‚
â”‚  - Dockerå®¹å™¨éš”ç¦»                   â”‚
â”‚  - ç½‘ç»œç­–ç•¥é™åˆ¶                     â”‚
â”‚  - ç³»ç»Ÿå®‰å…¨åŠ å›º                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç æ‰§è¡Œå®‰å…¨
```java
@Service
public class SecureCodeExecutor {
    
    @Value("${security.execution.timeout:30}")
    private int executionTimeout;
    
    @Value("${security.execution.memory:128}")
    private int memoryLimit;
    
    public ExecutionResult executeCode(String code, String language) {
        // å®‰å…¨æ£€æŸ¥
        validateCode(code, language);
        
        // åˆ›å»ºå®‰å…¨å®¹å™¨
        ContainerConfig config = ContainerConfig.builder()
            .image(getSecureImage(language))
            .cmd(Arrays.asList("timeout", String.valueOf(executionTimeout) + "s", 
                              getExecutionCommand(language)))
            .workingDir("/sandbox")
            .user("sandbox:sandbox") // érootç”¨æˆ·æ‰§è¡Œ
            .build();
            
        HostConfig hostConfig = HostConfig.builder()
            .memory((long) memoryLimit * 1024 * 1024)
            .cpuShares(512L)
            .networkMode("none") // ç¦ç”¨ç½‘ç»œè®¿é—®
            .readonlyRootfs(true) // åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ
            .noNewPrivileges(true) // ç¦æ­¢ææƒ
            .build();
            
        return executeInContainer(config, hostConfig, code);
    }
    
    private void validateCode(String code, String language) {
        // æ¶æ„ä»£ç æ£€æµ‹
        List<String> dangerousPatterns = Arrays.asList(
            "import\\s+os", "exec\\s*\\(", "eval\\s*\\(",
            "Runtime\\.getRuntime", "ProcessBuilder",
            "File\\s*\\(", "FileWriter", "socket"
        );
        
        for (String pattern : dangerousPatterns) {
            if (Pattern.compile(pattern, Pattern.CASE_INSENSITIVE).matcher(code).find()) {
                throw new SecurityException("æ£€æµ‹åˆ°æ½œåœ¨çš„å±é™©ä»£ç : " + pattern);
            }
        }
    }
}
```