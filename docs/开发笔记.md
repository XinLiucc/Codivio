# Codivio 开发笔记

> 记录项目开发过程中的技术笔记、工作内容和问题解答

## 2025-08-14 - 项目启动与基础架构搭建

### ✅ 完成的工作

#### 1. 项目基础架构搭建
- **Docker环境配置**
  - 创建 `docker-compose.yml` 统一编排服务
  - 配置 MySQL 8.0 数据库服务
  - 配置 Redis 7 缓存服务  
  - 配置 RabbitMQ 3 消息队列服务
  - 设置 Nginx 反向代理和负载均衡

- **数据库设计**
  - 创建用户服务数据库 `codivio_user`
  - 创建项目服务数据库 `codivio_project`
  - 设计用户表、项目表、文件表等基础表结构
  - 配置数据库初始化脚本

- **开发环境配置**
  - 添加 `.env` 环境变量配置
  - 更新 `.gitignore` 忽略不必要文件
  - 创建 `README-SETUP.md` 开发指南

#### 2. 用户服务基础框架
- **技术栈选择**
  - Spring Boot 3.2.0 + Java 17
  - Maven 项目管理
  - Logback 日志系统
  - Spring Actuator 监控

- **服务搭建**
  - 创建 Spring Boot 主启动类
  - 配置 `application.yml` 基础配置
  - 添加健康检查接口 `/api/user/health`
  - 配置 Spring Actuator 端点
  - 创建 Dockerfile 支持容器化

- **验证测试**
  - ✅ Maven 编译成功
  - ✅ 应用启动成功（8081端口）
  - ✅ 健康检查接口正常响应
  - ✅ Spring Actuator 监控正常

### 🤔 技术问题与解答

#### Q: Nginx在架构中的作用是什么？
**A: Nginx 作为反向代理和统一入口**
- **统一入口**: 所有外部请求通过 Nginx(80端口) 进入系统
- **路由分发**: 
  - `/api/*` → Gateway服务 (8080端口)
  - `/ws/*` → 协作服务WebSocket (8083端口)  
  - `/` → 前端静态资源 (3000端口)
- **负载均衡**: 支持服务多实例部署
- **静态资源服务**: 直接服务前端文件

#### Q: 服务间通信方式？
**A: 分层通信架构**
```
Frontend → Nginx(80) → Gateway(8080) → Services(808x)
                                     ↓
                               MySQL + Redis + RabbitMQ
```

- **当前阶段**: Frontend → Nginx → User-Service(8081)
- **完整架构**: Frontend → Nginx → Gateway → 各微服务

#### Q: 如何测试 User-Service？
**A: 三种测试方式**
1. **直接测试**: `curl http://localhost:8081/api/user/health`
2. **Docker测试**: `docker-compose up -d user-service`
3. **完整链路**: `curl http://localhost/api/user/health` (需要网关)

### 🎯 代码提交记录
- `feat: 搭建项目基础架构和Docker环境`
- `feat: 创建用户服务基础框架`

### 📝 开发心得
- 采用**渐进式开发**策略，先搭建基础框架再逐步完善功能
- **Docker化优先**，保证开发环境一致性  
- **健康检查**是微服务的基础，便于监控和调试
- **分离关注点**，基础设施和业务服务分别提交

## 2025-08-17 - Gateway服务基础框架搭建

### ✅ 完成的工作

#### 1. Gateway服务基础架构
- **Spring Cloud Gateway框架**
  - Spring Boot 3.2.0 + Spring Cloud 2023.0.0
  - 配置响应式Web框架（WebFlux + Netty）
  - 添加Actuator监控和健康检查

- **路由配置**
  - 用户服务路由：`/api/user/**` → `user-service:8081`
  - 项目服务路由：`/api/project/**` → `project-service:8082` (预留)
  - 协作服务路由：`/api/collaboration/**` → `collaboration-service:8083` (预留)
  - 文件服务路由：`/api/file/**` → `file-service:8084` (预留)

- **服务集成**
  - 创建Dockerfile支持容器化
  - 更新docker-compose.yml添加Gateway服务
  - Gateway健康检查接口：`/api/gateway/health`

- **验证测试**
  - ✅ Maven编译成功
  - ✅ 应用启动成功（8080端口）
  - ✅ 健康检查接口正常响应
  - ✅ 路由规则加载成功（4个服务）

#### 2. Project服务基础架构
- **Spring Boot Web框架**
  - Spring Boot 3.2.0 + Java 17
  - 传统Servlet容器（Tomcat）架构
  - 添加Actuator监控和健康检查

- **服务配置**
  - 服务端口：8082
  - 健康检查接口：`/api/project/health`
  - Actuator监控端点：`/actuator/health`, `/actuator/info`

- **容器化集成**
  - 创建Dockerfile支持容器化
  - 更新docker-compose.yml添加project-service配置
  - 配置依赖关系：依赖MySQL和Redis

- **验证测试**
  - ✅ Maven编译成功
  - ✅ 应用启动成功（8082端口）
  - ✅ 健康检查接口正常响应
  - ✅ Actuator监控端点可访问

#### 3. Collaboration服务基础架构
- **Spring Boot Web + WebSocket框架**
  - Spring Boot 3.2.0 + Java 17
  - 添加WebSocket支持，为实时协作功能做准备
  - 传统Servlet容器（Tomcat）架构
  - 添加Actuator监控和健康检查

- **服务配置**
  - 服务端口：8083
  - 健康检查接口：`/api/collaboration/health`
  - Actuator监控端点：`/actuator/health`, `/actuator/info`

- **容器化集成**
  - 创建Dockerfile支持容器化
  - 更新docker-compose.yml添加collaboration-service配置
  - 配置依赖关系：依赖MySQL、Redis和RabbitMQ（为消息传递做准备）

- **验证测试**
  - ✅ Maven编译成功
  - ✅ 应用启动成功（8083端口）
  - ✅ 健康检查接口正常响应
  - ✅ WebSocket依赖加载正常

### 🎯 代码提交记录
- `feat: 创建Gateway服务基础框架`
- `feat: 创建Project服务基础框架`
- `feat: 创建Collaboration服务基础框架`

### 📝 开发心得
- **架构优先**：先建立完整的微服务架构骨架，为后续开发提供清晰的服务边界
- **路由预留**：提前配置所有服务的路由规则，便于后续服务快速接入
- **渐进式验证**：每个服务都提供独立的健康检查，确保服务可用性
- **服务模板化**：基于成功经验，快速复制服务架构
- **端口规划**：按照规律分配端口，便于管理和记忆（8080→8081→8082→8083）
- **依赖分层**：不同服务依赖不同的基础设施，Collaboration服务增加了RabbitMQ依赖
- **技术选型**：针对不同服务特点选择合适技术栈，如Collaboration服务加入WebSocket支持

### 🔄 下一步计划
- 搭建文件服务（file-service）基础框架
- 完成整体微服务架构骨架后，再进行具体功能开发
- 测试完整的Gateway路由和服务间通信