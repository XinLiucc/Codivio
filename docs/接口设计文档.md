# Codivio RESTful API è®¾è®¡æ–‡æ¡£

## ğŸ¯ è®¾è®¡ç†å¿µ

æœ¬APIè®¾è®¡éµå¾ªRESTfulæ¶æ„åŸåˆ™ï¼Œä¸“æ³¨äº**MVPæ ¸å¿ƒåŠŸèƒ½**ï¼Œæä¾›æ¸…æ™°çš„æ¥å£è§„èŒƒå’Œè‰¯å¥½çš„å¼€å‘ä½“éªŒã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ”— **RESTfulè®¾è®¡** - èµ„æºå¯¼å‘ï¼Œè¯­ä¹‰æ¸…æ™°
- ğŸ” **JWTè®¤è¯** - æ— çŠ¶æ€è®¤è¯ï¼Œå®‰å…¨å¯é   
- ğŸš€ **ç»Ÿä¸€å“åº”** - æ ‡å‡†åŒ–æ•°æ®æ ¼å¼
- âš¡ **å®æ—¶é€šä¿¡** - WebSocketæ”¯æŒåä½œç¼–è¾‘
- ğŸ“Š **ç‰ˆæœ¬ç®¡ç†** - APIç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

## ğŸ“‹ æ¥å£æ¦‚è§ˆ

### åŸºç¡€ä¿¡æ¯
```yaml
ç”Ÿäº§ç¯å¢ƒ: https://api.codivio.dev/v1
å¼€å‘ç¯å¢ƒ: http://localhost:8080/api/v1
è®¤è¯æ–¹å¼: JWT Bearer Token
è¯·æ±‚æ ¼å¼: application/json
å“åº”æ ¼å¼: application/json
å­—ç¬¦ç¼–ç : UTF-8
```

### ç»Ÿä¸€å“åº”æ ¼å¼
```json
{
  "code": 200,
  "message": "success", 
  "data": {},
  "timestamp": 1640995200000
}
```

### HTTPçŠ¶æ€ç è§„èŒƒ
| çŠ¶æ€ç  | å«ä¹‰ | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| 200 | æˆåŠŸ | è¯·æ±‚æˆåŠŸå¤„ç† |
| 201 | å·²åˆ›å»º | èµ„æºåˆ›å»ºæˆåŠŸ |
| 400 | è¯·æ±‚é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ |
| 401 | æœªè®¤è¯ | Tokenæ— æ•ˆæˆ–ç¼ºå¤± |
| 403 | æ— æƒé™ | æƒé™éªŒè¯å¤±è´¥ |
| 404 | æœªæ‰¾åˆ° | èµ„æºä¸å­˜åœ¨ |
| 429 | é™æµ | è¯·æ±‚é¢‘ç‡è¶…é™ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | ç³»ç»Ÿå†…éƒ¨å¼‚å¸¸ |

---

## ğŸ‘¤ ç”¨æˆ·æœåŠ¡ API (User Service)

### 1. ç”¨æˆ·æ³¨å†Œ
```http
POST /api/v1/auth/register
Content-Type: application/json

{
  "username": "john_doe",
  "email": "john@example.com", 
  "password": "SecurePass123!",
  "nickname": "John"
}
```

**æˆåŠŸå“åº”** (201):
```json
{
  "code": 201,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "userId": 12345,
    "username": "john_doe",
    "email": "john@example.com",
    "nickname": "John",
    "avatar": "https://avatar.codivio.dev/default.png",
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 2. ç”¨æˆ·ç™»å½•
```http
POST /api/v1/auth/login
Content-Type: application/json

{
  "username": "john_doe",
  "password": "SecurePass123!"
}
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "tokenType": "Bearer",
    "expiresIn": 3600,
    "user": {
      "userId": 12345,
      "username": "john_doe",
      "email": "john@example.com",
      "nickname": "John",
      "avatar": "https://avatar.codivio.dev/john.png"
    }
  }
}
```

### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```http
GET /api/v1/users/me
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "userId": 12345,
    "username": "john_doe",
    "email": "john@example.com",
    "nickname": "John", 
    "avatar": "https://avatar.codivio.dev/john.png",
    "createdAt": "2024-01-01T00:00:00Z",
    "lastLoginAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. ç”¨æˆ·ç™»å‡º
```http
POST /api/v1/auth/logout
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

---

## ğŸ“ é¡¹ç›®æœåŠ¡ API (Project Service)

### 1. åˆ›å»ºé¡¹ç›®
```http
POST /api/v1/projects
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "name": "My React Project",
  "description": "ä¸€ä¸ªå­¦ä¹ Reactçš„åä½œé¡¹ç›®",
  "language": "javascript"
}
```

**æˆåŠŸå“åº”** (201):
```json
{
  "code": 201,
  "message": "é¡¹ç›®åˆ›å»ºæˆåŠŸ",
  "data": {
    "projectId": "proj_abc123",
    "name": "My React Project", 
    "description": "ä¸€ä¸ªå­¦ä¹ Reactçš„åä½œé¡¹ç›®",
    "language": "javascript",
    "owner": {
      "userId": 12345,
      "username": "john_doe",
      "nickname": "John"
    },
    "createdAt": "2024-01-15T10:30:00Z"
  }
}
```

### 2. è·å–é¡¹ç›®åˆ—è¡¨
```http
GET /api/v1/projects?page=1&size=20
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "projects": [
      {
        "projectId": "proj_abc123",
        "name": "My React Project",
        "description": "ä¸€ä¸ªå­¦ä¹ Reactçš„åä½œé¡¹ç›®", 
        "language": "javascript",
        "owner": {
          "userId": 12345,
          "username": "john_doe"
        },
        "memberCount": 2,
        "lastActivity": "2024-01-15T10:30:00Z",
        "createdAt": "2024-01-10T08:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 5,
      "totalPages": 1
    }
  }
}
```

### 3. è·å–é¡¹ç›®è¯¦æƒ…
```http
GET /api/v1/projects/{projectId}
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "projectId": "proj_abc123",
    "name": "My React Project",
    "description": "ä¸€ä¸ªå­¦ä¹ Reactçš„åä½œé¡¹ç›®",
    "language": "javascript", 
    "owner": {
      "userId": 12345,
      "username": "john_doe",
      "nickname": "John"
    },
    "members": [
      {
        "userId": 12345,
        "username": "john_doe",
        "nickname": "John", 
        "role": "owner",
        "joinedAt": "2024-01-10T08:00:00Z"
      },
      {
        "userId": 67890,
        "username": "jane_smith",
        "nickname": "Jane",
        "role": "editor", 
        "joinedAt": "2024-01-12T14:20:00Z"
      }
    ],
    "createdAt": "2024-01-10T08:00:00Z",
    "updatedAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. é‚€è¯·é¡¹ç›®æˆå‘˜
```http
POST /api/v1/projects/{projectId}/members
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "username": "jane_smith",
  "role": "editor"
}
```

**æˆåŠŸå“åº”** (201):
```json
{
  "code": 201,
  "message": "æˆå‘˜é‚€è¯·æˆåŠŸ",
  "data": {
    "userId": 67890,
    "username": "jane_smith",
    "role": "editor",
    "joinedAt": "2024-01-15T10:30:00Z"
  }
}
```

### 5. è·å–æ–‡ä»¶æ ‘
```http
GET /api/v1/projects/{projectId}/files
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "tree": [
      {
        "name": "src",
        "type": "directory",
        "path": "/src",
        "children": [
          {
            "name": "App.js",
            "type": "file", 
            "path": "/src/App.js",
            "size": 1024,
            "lastModified": "2024-01-15T10:30:00Z"
          },
          {
            "name": "index.js",
            "type": "file",
            "path": "/src/index.js", 
            "size": 512,
            "lastModified": "2024-01-14T16:20:00Z"
          }
        ]
      },
      {
        "name": "package.json",
        "type": "file",
        "path": "/package.json",
        "size": 256,
        "lastModified": "2024-01-10T08:00:00Z"
      }
    ]
  }
}
```

### 6. è·å–æ–‡ä»¶å†…å®¹ï¼ˆé€šè¿‡æ–‡ä»¶IDï¼‰
```http
GET /api/v1/projects/{projectId}/files/{fileId}/content
Authorization: Bearer <access_token>
```

**è¯´æ˜**: é¡¹ç›®æœåŠ¡è´Ÿè´£éªŒè¯æƒé™å’Œè·å–æ–‡ä»¶IDï¼Œç„¶åè°ƒç”¨æ–‡ä»¶æœåŠ¡è·å–å†…å®¹

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "fileId": "file_abc123",
    "path": "/src/App.js",
    "content": "import React from 'react';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <h1>Hello, Codivio!</h1>\n    </div>\n  );\n}\n\nexport default App;",
    "size": 1024,
    "version": 1,
    "lastModified": "2024-01-15T10:30:00Z"
  }
}
```

### 7. ä¿å­˜æ–‡ä»¶å†…å®¹
```http
PUT /api/v1/projects/{projectId}/files/{fileId}/content
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "content": "import React from 'react';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <h1>Hello, Codivio World!</h1>\n    </div>\n  );\n}\n\nexport default App;",
  "changeComment": "æ›´æ–°æ¬¢è¿æ–‡æœ¬"
}
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "æ–‡ä»¶ä¿å­˜æˆåŠŸ",
  "data": {
    "path": "/src/App.js",
    "size": 1056,
    "lastModified": "2024-01-15T10:35:00Z"
  }
}
```

### 8. åˆ›å»ºæ–‡ä»¶æ ‘èŠ‚ç‚¹
```http
POST /api/v1/projects/{projectId}/files/tree
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "path": "/src/components/Button.js",
  "name": "Button.js",
  "type": "file",
  "parentPath": "/src/components"
}
```

**æˆåŠŸå“åº”** (201):
```json
{
  "code": 201,
  "message": "æ–‡ä»¶æ ‘èŠ‚ç‚¹åˆ›å»ºæˆåŠŸ",
  "data": {
    "path": "/src/components/Button.js",
    "name": "Button.js",
    "type": "file",
    "fileId": "file_xyz789",
    "createdAt": "2024-01-15T10:40:00Z"
  }
}
```

**è¯´æ˜**: åˆ›å»ºæ–‡ä»¶ç±»å‹èŠ‚ç‚¹æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨æ–‡ä»¶æœåŠ¡ä¸­åˆ›å»ºå¯¹åº”çš„ç©ºæ–‡ä»¶

### 9. åˆ é™¤æ–‡ä»¶æ ‘èŠ‚ç‚¹
```http
DELETE /api/v1/projects/{projectId}/files/tree?path=/src/OldComponent.js
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "æ–‡ä»¶æ ‘èŠ‚ç‚¹åˆ é™¤æˆåŠŸ"
}
```

**è¯´æ˜**: åˆ é™¤æ–‡ä»¶ç±»å‹èŠ‚ç‚¹æ—¶ï¼Œä¼šé€šçŸ¥æ–‡ä»¶æœåŠ¡åˆ é™¤å¯¹åº”çš„ç‰©ç†æ–‡ä»¶

---

## ğŸ“ æ–‡ä»¶æœåŠ¡ API (File Service)

### 1. æ–‡ä»¶ä¸Šä¼ 
```http
POST /api/v1/files/upload
Authorization: Bearer <access_token>
Content-Type: multipart/form-data

{
  "file": <file_binary>,
  "projectId": "proj_abc123",
  "path": "/assets/images/",
  "description": "é¡¹ç›®å›¾æ ‡æ–‡ä»¶"
}
```

**æˆåŠŸå“åº”** (201):
```json
{
  "code": 201,
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ",
  "data": {
    "fileId": "file_def456",
    "fileName": "logo.png",
    "originalName": "company-logo.png",
    "filePath": "/assets/images/logo.png",
    "size": 15360,
    "mimeType": "image/png",
    "url": "https://files.codivio.dev/proj_abc123/assets/images/logo.png",
    "uploadedAt": "2024-01-15T10:30:00Z"
  }
}
```

### 2. æ–‡ä»¶ä¸‹è½½
```http
GET /api/v1/files/{fileId}/download
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```http
HTTP/1.1 200 OK
Content-Type: image/png
Content-Disposition: attachment; filename="logo.png"
Content-Length: 15360

[æ–‡ä»¶äºŒè¿›åˆ¶å†…å®¹]
```

### 3. è·å–æ–‡ä»¶ä¿¡æ¯
```http
GET /api/v1/files/{fileId}
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "fileId": "file_def456",
    "fileName": "logo.png",
    "originalName": "company-logo.png",
    "filePath": "/assets/images/logo.png",
    "size": 15360,
    "mimeType": "image/png",
    "projectId": "proj_abc123",
    "uploadedBy": {
      "userId": 12345,
      "username": "john_doe"
    },
    "url": "https://files.codivio.dev/proj_abc123/assets/images/logo.png",
    "createdAt": "2024-01-15T10:30:00Z",
    "updatedAt": "2024-01-15T10:30:00Z"
  }
}
```

### 4. æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 
```http
POST /api/v1/files/batch-upload
Authorization: Bearer <access_token>
Content-Type: multipart/form-data

{
  "files": [<file1_binary>, <file2_binary>],
  "projectId": "proj_abc123",
  "path": "/documents/"
}
```

### 5. åˆ é™¤æ–‡ä»¶
```http
DELETE /api/v1/files/{fileId}
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "æ–‡ä»¶åˆ é™¤æˆåŠŸ"
}
```

### 6. è·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
```http
GET /api/v1/files?projectId={projectId}&path=/assets/&page=1&size=20
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "files": [
      {
        "fileId": "file_def456",
        "fileName": "logo.png",
        "filePath": "/assets/images/logo.png",
        "size": 15360,
        "mimeType": "image/png",
        "url": "https://files.codivio.dev/proj_abc123/assets/images/logo.png",
        "createdAt": "2024-01-15T10:30:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "size": 20,
      "total": 1,
      "totalPages": 1
    }
  }
}
```

### 7. æ–‡ä»¶é¢„è§ˆé“¾æ¥
```http
GET /api/v1/files/{fileId}/preview
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "previewUrl": "https://files.codivio.dev/preview/proj_abc123/logo.png?token=temp_access_token",
    "thumbnailUrl": "https://files.codivio.dev/thumbnail/proj_abc123/logo.png?token=temp_access_token",
    "expiresAt": "2024-01-15T11:30:00Z"
  }
}
```

### 8. åˆ›å»ºç©ºæ–‡ä»¶ï¼ˆå†…éƒ¨APIï¼‰
```http
POST /api/v1/files/internal/create
Authorization: Bearer <service_token>
Content-Type: application/json

{
  "projectId": "proj_abc123",
  "fileName": "Button.js",
  "mimeType": "text/javascript",
  "content": ""
}
```

**è¯´æ˜**: æ­¤APIä¾›é¡¹ç›®æœåŠ¡è°ƒç”¨ï¼Œåˆ›å»ºæ–‡ä»¶æ ‘èŠ‚ç‚¹æ—¶ä½¿ç”¨

### 9. è·å–æ–‡ä»¶å†…å®¹ï¼ˆå†…éƒ¨APIï¼‰
```http
GET /api/v1/files/internal/{fileId}/content
Authorization: Bearer <service_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "fileId": "file_abc123",
    "content": "import React from 'react';...",
    "version": 1,
    "size": 1024,
    "mimeType": "text/javascript",
    "lastModified": "2024-01-15T10:30:00Z"
  }
}
```

### 10. æ›´æ–°æ–‡ä»¶å†…å®¹ï¼ˆå†…éƒ¨APIï¼‰
```http
PUT /api/v1/files/internal/{fileId}/content
Authorization: Bearer <service_token>
Content-Type: application/json

{
  "content": "updated file content",
  "changedBy": 12345,
  "changeComment": "ä¿®æ”¹è¯´æ˜"
}
```

### 11. åˆ é™¤æ–‡ä»¶ï¼ˆå†…éƒ¨APIï¼‰
```http
DELETE /api/v1/files/internal/{fileId}
Authorization: Bearer <service_token>
```

**è¯´æ˜**: è¿™äº›å†…éƒ¨APIä¾›å…¶ä»–å¾®æœåŠ¡è°ƒç”¨ï¼Œä¸å¯¹å¤–å¼€æ”¾

---

## âš¡ åä½œæœåŠ¡ API (Collaboration Service)

### WebSocket è¿æ¥è§„èŒƒ

#### è¿æ¥åœ°å€
```javascript
// å¼€å‘ç¯å¢ƒ
const wsUrl = 'ws://localhost:8083/ws/editor';
// ç”Ÿäº§ç¯å¢ƒ  
const wsUrl = 'wss://collab.codivio.dev/ws/editor';

const socket = new WebSocket(wsUrl);
```

#### è¿æ¥è®¤è¯
```javascript
// è¿æ¥å»ºç«‹åå‘é€è®¤è¯æ¶ˆæ¯
socket.onopen = function() {
  socket.send(JSON.stringify({
    type: 'auth',
    data: {
      token: 'your_jwt_token'
    }
  }));
};
```

### WebSocket æ¶ˆæ¯æ ¼å¼

#### 1. åŠ å…¥æ–‡æ¡£ç¼–è¾‘
```json
{
  "type": "join-document",
  "data": {
    "projectId": "proj_abc123",
    "filePath": "/src/App.js",
    "userId": 12345
  }
}
```

**æœåŠ¡å™¨å“åº”**:
```json
{
  "type": "document-joined",
  "data": {
    "documentId": "doc_proj_abc123_src_App_js",
    "content": "import React from 'react';...",
    "version": 42,
    "activeUsers": [
      {
        "userId": 12345,
        "username": "john_doe",
        "cursorPosition": 120,
        "cursorColor": "#ff6b6b"
      }
    ]
  }
}
```

#### 2. ç¼–è¾‘æ“ä½œ (Operation Transformation)
```json
{
  "type": "operation",
  "data": {
    "documentId": "doc_proj_abc123_src_App_js",
    "operation": {
      "type": "insert",
      "position": 100,
      "text": "Hello, World!",
      "timestamp": 1640995200000
    }
  }
}
```

**æ“ä½œç±»å‹**:
- `insert`: æ’å…¥æ–‡æœ¬
- `delete`: åˆ é™¤æ–‡æœ¬  
- `retain`: ä¿ç•™æ–‡æœ¬

#### 3. å…‰æ ‡ä½ç½®åŒæ­¥
```json
{
  "type": "cursor-update",
  "data": {
    "documentId": "doc_proj_abc123_src_App_js", 
    "position": 150,
    "selection": {
      "start": 150,
      "end": 165
    }
  }
}
```

#### 4. ç¦»å¼€æ–‡æ¡£
```json
{
  "type": "leave-document",
  "data": {
    "documentId": "doc_proj_abc123_src_App_js"
  }
}
```

### HTTP æ¥å£è¡¥å……

#### è·å–åœ¨çº¿ç”¨æˆ·
```http
GET /api/v1/collaboration/documents/{documentId}/users
Authorization: Bearer <access_token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "activeUsers": [
      {
        "userId": 12345,
        "username": "john_doe",
        "nickname": "John",
        "joinedAt": "2024-01-15T10:30:00Z",
        "cursorPosition": 120
      }
    ],
    "totalCount": 1
  }
}
```

---

## ğŸ” è®¤è¯å’Œæˆæƒ

### JWT Token ç»“æ„
```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "sub": "12345",
    "username": "john_doe", 
    "roles": ["user"],
    "iat": 1640995200,
    "exp": 1640998800
  }
}
```

### æƒé™è§’è‰²å®šä¹‰
```yaml
é¡¹ç›®è§’è‰²:
  owner: é¡¹ç›®æ‰€æœ‰è€…
    - é¡¹ç›®ç®¡ç†ï¼ˆå¢åˆ æ”¹ï¼‰
    - æˆå‘˜ç®¡ç†ï¼ˆé‚€è¯·/ç§»é™¤ï¼‰
    - æ–‡ä»¶æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
    - å®æ—¶åä½œï¼ˆè¯»å†™ï¼‰
    
  editor: é¡¹ç›®ç¼–è¾‘è€…  
    - æ–‡ä»¶æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
    - å®æ—¶åä½œï¼ˆè¯»å†™ï¼‰
    
  viewer: é¡¹ç›®æŸ¥çœ‹è€…
    - æ–‡ä»¶æŸ¥çœ‹ï¼ˆåªè¯»ï¼‰
    - å®æ—¶åä½œï¼ˆåªè¯»ï¼‰
```

### æƒé™æ£€æŸ¥ä¸­é—´ä»¶
```http
# è¯·æ±‚å¤´æºå¸¦Token
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# å“åº”å¤´è¿”å›ç”¨æˆ·ä¿¡æ¯
X-User-Id: 12345
X-Username: john_doe
```

---

## ğŸš« é”™è¯¯å¤„ç†è§„èŒƒ

### æ ‡å‡†é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "å‚æ•°éªŒè¯å¤±è´¥",
  "data": {
    "errors": [
      {
        "field": "username",
        "message": "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¸ªå­—ç¬¦ä¹‹é—´"
      },
      {
        "field": "email", 
        "message": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
      }
    ]
  },
  "timestamp": 1640995200000
}
```

### å¸¸è§é”™è¯¯åœºæ™¯

#### 1. è®¤è¯å¤±è´¥ (401)
```json
{
  "code": 401,
  "message": "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "data": {
    "errorType": "INVALID_TOKEN",
    "suggestion": "è¯·é‡æ–°ç™»å½•"
  }
}
```

#### 2. æƒé™ä¸è¶³ (403)
```json
{
  "code": 403,
  "message": "æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº",
  "data": {
    "errorType": "ACCESS_DENIED",
    "resource": "project:proj_abc123",
    "requiredRole": "editor"
  }
}
```

#### 3. èµ„æºä¸å­˜åœ¨ (404)
```json
{
  "code": 404,
  "message": "é¡¹ç›®ä¸å­˜åœ¨",
  "data": {
    "errorType": "RESOURCE_NOT_FOUND",
    "resource": "project",
    "resourceId": "proj_xyz789"
  }
}
```

#### 4. è¯·æ±‚é™æµ (429)
```json
{
  "code": 429, 
  "message": "è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•",
  "data": {
    "errorType": "RATE_LIMIT_EXCEEDED",
    "retryAfter": 60,
    "limit": 100,
    "remaining": 0
  }
}
```

---

## ğŸ“Š API é™æµç­–ç•¥

### é™æµè§„åˆ™
| APIç±»å‹ | é™åˆ¶ | æ—¶é—´çª—å£ | èŒƒå›´ |
|---------|------|----------|------|
| è®¤è¯æ¥å£ | 5æ¬¡/åˆ†é’Ÿ | æ»‘åŠ¨çª—å£ | æ¯IP |
| æ™®é€šæ¥å£ | 100æ¬¡/åˆ†é’Ÿ | æ»‘åŠ¨çª—å£ | æ¯ç”¨æˆ· |
| WebSocketæ¶ˆæ¯ | 500æ¡/åˆ†é’Ÿ | æ»‘åŠ¨çª—å£ | æ¯è¿æ¥ |

### é™æµå“åº”å¤´
```http
HTTP/1.1 200 OK
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1640995260
Content-Type: application/json
```

---

## ğŸ”§ å¼€å‘è°ƒè¯•

### APIè°ƒè¯•å·¥å…·
```bash
# ä½¿ç”¨curlæµ‹è¯•ç™»å½•æ¥å£
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "john_doe",
    "password": "SecurePass123!"
  }'

# ä½¿ç”¨è·å–åˆ°çš„tokenè®¿é—®å—ä¿æŠ¤æ¥å£
curl -X GET http://localhost:8080/api/v1/users/me \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

### WebSocketè°ƒè¯•
```javascript
// æµè§ˆå™¨æ§åˆ¶å°è°ƒè¯•WebSocket
const ws = new WebSocket('ws://localhost:8083/ws/editor');

ws.onopen = () => {
  console.log('WebSocketè¿æ¥å»ºç«‹');
  // å‘é€è®¤è¯æ¶ˆæ¯
  ws.send(JSON.stringify({
    type: 'auth',
    data: { token: 'YOUR_JWT_TOKEN' }
  }));
};

ws.onmessage = (event) => {
  console.log('æ”¶åˆ°æ¶ˆæ¯:', JSON.parse(event.data));
};
```

---

## ğŸ“ˆ é¢è¯•å‡†å¤‡è¦ç‚¹

### ğŸ’¡ æŠ€æœ¯äº®ç‚¹
1. **RESTfulè®¾è®¡åŸåˆ™** - èµ„æºå¯¼å‘ï¼ŒçŠ¶æ€ç è¯­ä¹‰æ¸…æ™°
2. **å¾®æœåŠ¡APIç½‘å…³** - ç»Ÿä¸€å…¥å£ï¼ŒæœåŠ¡éš”ç¦»
3. **JWTæ— çŠ¶æ€è®¤è¯** - åˆ†å¸ƒå¼å‹å¥½ï¼Œå®‰å…¨å¯é 
4. **WebSocketå®æ—¶é€šä¿¡** - ä½å»¶è¿Ÿï¼ŒåŒå‘é€šä¿¡
5. **APIç‰ˆæœ¬ç®¡ç†** - å‘åå…¼å®¹ï¼Œå¹³æ»‘å‡çº§

### ğŸ¯ å¸¸è§é¢è¯•é—®é¢˜

#### 1. "ä¸ºä»€ä¹ˆé€‰æ‹©RESTfulè€Œä¸æ˜¯GraphQLï¼Ÿ"
```yaml
å›ç­”è¦ç‚¹:
  - RESTfulç®€å•æ˜“æ‡‚ï¼Œå­¦ä¹ æˆæœ¬ä½
  - ç¼“å­˜ç­–ç•¥æˆç†Ÿï¼ŒHTTPç¼“å­˜ç›´æ¥å¯ç”¨
  - å·¥å…·ç”Ÿæ€ä¸°å¯Œï¼Œè°ƒè¯•æ–¹ä¾¿
  - é€‚åˆCRUDä¸ºä¸»çš„ä¸šåŠ¡åœºæ™¯
  - GraphQLæ›´é€‚åˆå¤æ‚æŸ¥è¯¢åœºæ™¯
```

#### 2. "å¦‚ä½•ä¿è¯APIçš„å®‰å…¨æ€§ï¼Ÿ"
```yaml
å›ç­”è¦ç‚¹:
  - JWT Tokenè®¤è¯ï¼Œæ— çŠ¶æ€è®¾è®¡
  - HTTPSåŠ å¯†ä¼ è¾“
  - æƒé™ç»†ç²’åº¦æ§åˆ¶ï¼ˆRBACï¼‰
  - è¯·æ±‚é™æµé˜²æ­¢æ»¥ç”¨
  - å‚æ•°éªŒè¯é˜²æ­¢æ³¨å…¥æ”»å‡»
```

#### 3. "å¦‚ä½•å¤„ç†APIç‰ˆæœ¬å‡çº§ï¼Ÿ"
```yaml
å›ç­”è¦ç‚¹:
  - URLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶ (/v1, /v2)
  - å‘åå…¼å®¹åŸåˆ™
  - æ¸è¿›å¼è¿ç§»ç­–ç•¥
  - æ–‡æ¡£å’Œé€šçŸ¥æœºåˆ¶
  - åºŸå¼ƒæ—¶é—´è¡¨è§„åˆ’
```

#### 4. "WebSocketç›¸æ¯”HTTPè½®è¯¢çš„ä¼˜åŠ¿ï¼Ÿ"
```yaml
å›ç­”è¦ç‚¹:
  - å‡å°‘ç½‘ç»œå¼€é”€ï¼ŒåŒå‘é€šä¿¡
  - é™ä½å»¶è¿Ÿï¼Œå®æ—¶æ€§æ›´å¥½
  - æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ï¼Œç”¨æˆ·ä½“éªŒä½³
  - è¿æ¥ä¿æŒï¼Œé¿å…é¢‘ç¹æ¡æ‰‹
  - é€‚åˆå®æ—¶åä½œåœºæ™¯
```

### ğŸš€ æ‰©å±•æ€è€ƒ

å½“é¢è¯•å®˜é—®"å¦‚æœç³»ç»Ÿè§„æ¨¡æ‰©å¤§100å€æ€ä¹ˆåŠï¼Ÿ"æ—¶çš„ç­”æ¡ˆï¼š

```yaml
APIç½‘å…³å±‚:
  - ç½‘å…³é›†ç¾¤éƒ¨ç½²ï¼Œè´Ÿè½½å‡è¡¡
  - APIç¼“å­˜ç­–ç•¥ï¼Œå‡å°‘åç«¯å‹åŠ›
  - é™æµç†”æ–­ï¼Œä¿æŠ¤åç«¯æœåŠ¡

æœåŠ¡å±‚:
  - å¾®æœåŠ¡æ°´å¹³æ‰©å®¹
  - æ•°æ®åº“è¯»å†™åˆ†ç¦»
  - ç¼“å­˜é›†ç¾¤åŒ–ï¼ˆRedis Clusterï¼‰

åä½œå±‚:
  - WebSocketè¿æ¥æ± ç®¡ç†
  - æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤åŒ–
  - æ“ä½œè½¬æ¢ç®—æ³•ä¼˜åŒ–
```